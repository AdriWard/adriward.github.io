const DATA = 
{
    "infoData" : 
    {
        "DemiGrandAxe":"km",
            "revolution":"jours",
            "rayon": "km",
            "superficie" : "km2",
            "volume": "km3",
            "masse": "kg",
            "gravity":"m/s2",
            "periodeRotation": "jours",
            "temperature":"Â°C"
    },
    "corps": 
    [
        {
            "id" : "sun",
            "name" : "Soleil",
            "distance": 0,
            "rayon" : 150,
            "color" : "#fcbf1e",
            "revolution": 0,
            "flag": 0,
            "data": 
                {
                    "DemiGrandAxe":0,
                    "revolution":0,
                    "rayon": 696342,
                    "superficie" : {
                        "superficieValue":6.0877,
                        "superficieExponent":12
                    },
                    "volume": {
                        "volumeValue" : 1.412,
                        "volumeExponent":18
                    },
                    "masse": {
                        "masseValue" : 1.9891,
                        "masseExponent":30
                    },
                    "gravity":273.95,
                    "periodeRotation": 0,
                    "temperature":500000  
                }
        },
        {
            "id" : "mercure",
            "name" : "Mercure",
            "distance": 180,
            "rayon" : 12,
            "color" : "#f2f2f2",
            "revolution": 8,
            "flag": 0,
            "data": 
                {
                    "DemiGrandAxe":57909230,
                    "revolution":87.95565,
                    "rayon": 2439.7,
                    "superficie" : {
                        "superficieValue":75,
                        "superficieExponent":6
                    },
                    "volume": {
                        "volumeValue" : 60.83,
                        "volumeExponent":9
                    },
                    "masse": {
                        "masseValue" : 3.3011,
                        "masseExponent":23
                    },
                    "gravity":3.701,
                    "periodeRotation": 58.6462,
                    "temperature":169  
                }
        },
        {
            "id" : "venus",
            "name" : "Venus",
            "distance": 230,
            "rayon" : 17,
            "color" : "#e58a8a",
            "revolution": 22,
            "flag": 0,
            "data": 
                {
                    "DemiGrandAxe":108209500,
                    "revolution":224.667,
                    "rayon": 6051.8,
                    "superficie" : {
                        "superficieValue":460,
                        "superficieExponent":6
                    },
                    "volume": {
                        "volumeValue" : 928.43,
                        "volumeExponent":9
                    },
                    "masse": {
                        "masseValue" : 4.8685,
                        "masseExponent":24
                    },
                    "gravity":8.87,
                    "periodeRotation": -243.023,
                    "temperature":462  
                }
        },
        {
            "id" : "terre",
            "name" : "Terre",
            "distance": 280,
            "rayon" : 19,
            "color" : "#0779e4",
            "revolution": 36,
            "flag": 0,
            "data": 
                {
                    "DemiGrandAxe":149597887.5,
                    "revolution":365.256363,
                    "rayon": 6371,
                    "superficie" : {
                        "superficieValue":510,
                        "superficieExponent":6
                    },
                    "volume": {
                        "volumeValue" : 1.083,
                        "volumeExponent":12
                    },
                    "masse": {
                        "masseValue" : 5.9736,
                        "masseExponent":24
                    },
                    "gravity":9.80665,
                    "periodeRotation": 0.99726949,
                    "temperature":15  
                }
        },
        {
            "id" : "mars",
            "name" : "Mars",
            "distance": 330,
            "rayon" : 10,
            "color" : "#fbb4ae",
            "revolution": 68,
            "flag": 0,
            "data": 
                {
                    "DemiGrandAxe":227944000,
                    "revolution":686.885,
                    "rayon": 3389.5,
                    "superficie" : {
                        "superficieValue":144.798500,
                        "superficieExponent":6
                    },
                    "volume": {
                        "volumeValue" : 163.18,
                        "volumeExponent":9
                    },
                    "masse": {
                        "masseValue" : 6.4185,
                        "masseExponent":23
                    },
                    "gravity":3.711,
                    "periodeRotation": 1.025957,
                    "temperature":-63
                }
        },
        {
            "id" : "jupiter",
            "name" : "Jupiter",
            "distance": 520,
            "rayon" : 69,
            "color" : "#fed9a6",
            "revolution": 433,
            "flag": 0,
            "data": 
                {
                    "DemiGrandAxe":778340000,
                    "revolution":4332.01,
                    "rayon": 69911,
                    "superficie" : {
                        "superficieValue":6.14,
                        "superficieExponent":10
                    },
                    "volume": {
                        "volumeValue" : 1.43228,
                        "volumeExponent":15
                    },
                    "masse": {
                        "masseValue" : 1.8986,
                        "masseExponent":27
                    },
                    "gravity":24.7964249,
                    "periodeRotation": 0.41351,
                    "temperature":-163
                }
        },
        {
            "id" : "saturne",
            "name" : "Saturne",
            "distance": 680,
            "rayon" : 58,
            "color" : "#fdd998",
            "revolution": 1075,
            "flag": 0,
            "data": 
                {
                    "DemiGrandAxe":1426700000,
                    "revolution":10754,
                    "rayon": 58232,
                    "superficie" : {
                        "superficieValue":43.466,
                        "superficieExponent":9
                    },
                    "volume": {
                        "volumeValue" : 827.13,
                        "volumeExponent":12
                    },
                    "masse": {
                        "masseValue" : 568.46,
                        "masseExponent":24
                    },
                    "gravity":10.44,
                    "periodeRotation": 0.448,
                    "temperature":-191.9
                }
        },
        {
            "id" : "uranus",
            "name" : "Uranus",
            "distance": 800,
            "rayon" : 25,
            "color" : "#40bad5",
            "revolution": 300,
            "flag": 0,
            "data": 
                {
                    "DemiGrandAxe":2870700000,
                    "revolution":30698,
                    "rayon": 25559,
                    "superficie" : {
                        "superficieValue":8.0831,
                        "superficieExponent":9
                    },
                    "volume": {
                        "volumeValue" : 6.83344,
                        "volumeExponent":13
                    },
                    "masse": {
                        "masseValue" : 8.6810,
                        "masseExponent":25
                    },
                    "gravity":8.87,
                    "periodeRotation": -0.718,
                    "temperature":-216
                }
        },
        {
            "id" : "neptune",
            "name" : "Neptune",
            "distance": 980,
            "rayon" : 24,
            "color" : "#035aa6",
            "revolution": 600,
            "flag": 0,
            "data": 
                {
                    "DemiGrandAxe":4498400000,
                    "revolution":60216.8,
                    "rayon": 24622,
                    "superficie" : {
                        "superficieValue":7.6408,
                        "superficieExponent":9
                    },
                    "volume": {
                        "volumeValue" : 62.526,
                        "volumeExponent":12
                    },
                    "masse": {
                        "masseValue" : 102.43,
                        "masseExponent":24
                    },
                    "gravity":11.15,
                    "periodeRotation": 0.67125,
                    "temperature":-226.4
                }
        }
    ]
};



const xCentre = 1000;

const yCentre = 1000;

const svg = d3.select('#sunSystem')
                .style('height','95vh')
                .style('width','100vw')
                .on("click", () => {
                    if(d3.event.target.localName == 'svg')
                    {
                        hiddenInfo()
                        DATA.corps.forEach(d => hiddenPlanet(d))
                        DATA.corps.forEach(d => d.flag = 0)
                    }
                })


const planet = svg.selectAll('g')
                .data(DATA.corps)
                .join('g')
                .attr('class',d => d.id)


planet.on("mouseover",d => {if(!d.flag && !flagAll) {showPlanet(d)}})
      .on("mouseout", d =>{if(!d.flag && !flagAll) {hiddenPlanet(d)}})
      .on("click", d => {if(!flagAll) {clickPlanet(d)}})

planet.append('circle')
.attr('id',d => d.id)
.attr('cx',d => xCentre - d.distance)
.attr('cy',yCentre)
.attr('fill',d => d.color)
.attr('r',d => d.rayon)
.append('animateTransform')
.attr('attributeName','transform')
.attr('type','rotate')
.attr('from', d => `${0 + 15*d.rayon} ${xCentre} ${yCentre}`)
.attr('to', d =>`${360 + 15*d.rayon} ${xCentre} ${yCentre}`)
.attr('dur',d => d.revolution)
.attr('repeatCount','indefinite');


/**
planet.append('text')
    .attr('class',d => `text${d.id}`)
    .attr('x',d => xCentre - 20 )
    .attr('y',yCentre - 20)
    .attr('fill',d => d.color)
    .attr('font-family','Verdana')
    .attr('foot-size',55)
    .attr('text-anchor','start')
    .text(d => d.name)
    .style('visibility','hidden')
    .append('animateTransform')
    .attr('attributeName','transform')
    .attr('type','rotate')
    .attr('from', `0 ${xCentre} ${yCentre}`)
    .attr('to',`360 ${xCentre} ${yCentre}`)
    .attr('dur',d => d.revolution)
    .attr('repeatCount','indefinite');
*/

planet.append('circle')
.attr("class",d => `orbite${d.id}`)
.attr('cx',xCentre)
.attr('cy',yCentre)
.attr('r', d => d.distance)
.attr('stroke', d => d.color)
.attr('fill','none')
.style('opacity',0)
.style('stroke-width',2)

planet.append('circle')
.attr("class",d => `orbite2${d.id}`)
.attr('cx',xCentre)
.attr('cy',yCentre)
.attr('r', d => d.distance)
.attr('stroke', d => d.color)
.attr('fill','none')
.style('opacity',0)
.style('stroke-width',35)





/**
let boxInfo =  d3.select('.info')
.style('position','absolute')
.style('top','100px')
.style('right','10%')
.style('height','400px')
.style('width','200px')
.style('background-color','white')
.style('box-shadow','1px 1px 5px #555')
.style('border-radius','10px')
.style('color','gray')
.style('font-family','Verdana')
.style('font-size','12px')
.style('text-align','center')
.style('visibility','hidden')
*/

let infoPlanete = (info) => {

        let boxInfo =  d3.select('.info')

        boxInfo.text('')
                .style('visibility','visible')

        boxInfo.append('h3')
                .text(info.name)
                .style('color',info.color)

        boxInfo.append('p')
                .text(`Demi-Grand axe : ${info.data.DemiGrandAxe} ${DATA.infoData.DemiGrandAxe}`)

        boxInfo.append('p')
                .text(`revolution : ${info.data.revolution} ${DATA.infoData.revolution}`)
        
        boxInfo.append('p')
                .text(`rayon : ${info.data.rayon} ${DATA.infoData.rayon}`)
        
        boxInfo.append('p')
                .text(`superficie : ${info.data.superficie.superficieValue}x10*${info.data.superficie.superficieExponent} ${DATA.infoData.superficie}`)

        boxInfo.append('p')
                .text(`volume : ${info.data.volume.volumeValue}x10*${info.data.volume.volumeExponent} ${DATA.infoData.volume}`)

        boxInfo.append('p')
                .text(`masse : ${info.data.masse.masseValue}x10*${info.data.masse.masseExponent} ${DATA.infoData.masse}`)

        boxInfo.append('p')
                .text(`gravity : ${info.data.gravity} ${DATA.infoData.gravity}`)

        boxInfo.append('p')
                .text(`Rotation : ${info.data.periodeRotation} ${DATA.infoData.periodeRotation}`)

        boxInfo.append('p')
                .text(`temperature : ${info.data.temperature} ${DATA.infoData.temperature}`)

}

let hiddenInfo = () => {

        d3.select('.info').text('').style('visibility','hidden')

}

    
  
  let showPlanet = (d) => {

    d3.select(`.orbite${d.id}`)
        .style('opacity',100)
        

    d3.selectAll(`.text${d.id}`)
        .style('visibility','visible')

    d3.select(`button.${d.id}`)
        .style('color',d => d.color)

    d3.select(`.line${d.id}`)
        .style('opacity',100)

    if(d.id == 'sun')
    {
        d3.selectAll('g.sun circle').style('fill','#d8345f')
    }
   
   } 



let hiddenPlanet = (d) => {

    d3.select(`.orbite${d.id}`)
        .style('opacity',0)
        

    d3.selectAll(`.text${d.id}`)
        .style('visibility','hidden')

    d3.select(`button.${d.id}`)
        .style('color','white')

    d3.select(`.line${d.id}`)
        .style('opacity',0)
    

    if(d.id == 'sun')
    {
        d3.selectAll('g.sun circle').style('fill',d => d.color)
    }

   }


   let clickPlanet = (d) => {

    zeroFlage(d.id);

    if(d.flag)
    {
        d.flag = 0;
        hiddenPlanet(d)

        hiddenInfo()
    }
    else
    {
        d.flag = 1;
        showPlanet(d)

        infoPlanete(d)
    }

   }


let zeroFlage = (planet) => {

    DATA.corps.forEach( d => {

        if(planet != d.id)
        {
            d.flag = 0;
            hiddenPlanet(d)
        }
    })
}

let clickDistance = (d) => {

    zeroFlage(d.id);

    if(d.flag)
    {
        d.flag = 0;
        hiddenPlanet(d)
    }
    else
    {
        d.flag = 1;
        showPlanet(d)
    }

}





const menu = d3.select('nav .planet')

let flagHiddenMenu = 1

menu.selectAll('button')
    .data(DATA.corps)
    .enter()
    .append('button')
    .attr('class',d => d.id)
    .text(d => d.name)
    .on("mouseover",d => {if(!d.flag) {showPlanet(d)}})
    .on("mouseout", d =>{if(!d.flag) {hiddenPlanet(d)}})
    .on("click", d => {if(flagHiddenMenu) {clickPlanet(d)} else {clickDistance(d)}})

    
    d3.select('nav .distance')
    .on("click", () => showDistance())

    d3.select('nav .systeme')
    .on("click", () => showSystem())

    d3.select('nav .volume')
    .on("click", () => showVolume())

   
let showDistance = () => {
   
    d3.select('svg#sunSystem')
            .transition()
            .duration(1000)
            .style('height','0vh')
            .style('width','0vm')

    d3.select('svg#volume')
            .transition()
            .duration(1000)
            .style('height','0vh')
            .style('width','0vm')
   
   d3.select('svg#distance')
            .transition()
            .duration(1000)
            .style('height','95vh')
            .style('width','100vw')

    flagHiddenMenu = 0

    hiddenInfo()

}

let showSystem = () => {

    d3.select('svg#distance')
            .transition()
            .duration(1000)
            .style('height','0vh')
            .style('width','0vm')

    d3.select('svg#volume')
            .transition()
            .duration(1000)
            .style('height','0vh')
            .style('width','0vm')
   
   d3.select('svg#sunSystem')
            .transition()
            .duration(1000)
            .style('height','95vh')
            .style('width','100vw')


    DATA.corps.forEach(d => {

        if(d.flag)
        {
            infoPlanete(d)
        }                    
     });

    flagHiddenMenu = 1

    

}


let showVolume = () => {

    d3.select('svg#distance')
            .transition()
            .duration(1000)
            .style('height','0vh')
            .style('width','0vm')

    d3.select('svg#sunSystem')
            .transition()
            .duration(1000)
            .style('height','0vh')
            .style('width','0vm')
   
   d3.select('svg#volume')
            .transition()
            .duration(1000)
            .style('height','95vh')
            .style('width','100vw')

    flagHiddenMenu = 0

    hiddenInfo()

}

 

let flagAll = 0

let clickAll = () => {

    flagAll = !flagAll

    if(flagAll)
    {
        d3.selectAll('g.sun circle').style('fill','#d8345f')

        DATA.corps.forEach( d => {

            hiddenPlanet(d)
                   
            d3.select(`.orbite${d.id}`)
                .style('opacity',100)

            d3.select(`.line${d.id}`)
                .style('opacity',100)

            d3.select(`#volume .text${d.id}`)
                .style('visibility','visible')
        })

        hiddenInfo()
    }
    else
    {
        d3.selectAll('g.sun circle').style('fill',d => d.color)

        DATA.corps.forEach( d => {

            hiddenPlanet(d)
            d.flag = 1
        })
    }    

}


let svgLogo = d3.select('#logo')
                .on('click',() => clickAll())
                .append('g')
                .join('g')
                


    svgLogo.append('circle')
    .attr('cx',100)
    .attr('cy',100)
    .attr('fill','white')
    .attr('r',20)


    svgLogo.append('circle')
    .attr('cx',20 )
    .attr('cy',100)
    .attr('fill','white')
    .attr('r',20)
    .append('animateTransform')
    .attr('attributeName','transform')
    .attr('type','rotate')
    .attr('from', `0 100 100`)
    .attr('to',`360 100 100`)
    .attr('dur',40)
    .attr('repeatCount','indefinite');

    
    svgLogo.append('circle')
    .attr('cx',100)
    .attr('cy',100)
    .attr('r', 80)
    .attr('stroke','white')
    .attr('fill','none')
    .style('opacity',100)
    .style('stroke-width',2)
    


d3.select('.drop')
    .attr('ondrop','drop(event)')
    .attr('ondragover','event.preventDefault()')


d3.select('.info')
    .attr('draggable',"true")


let drop = () => {

       d3.select('.info')
        .style('top',`${event.pageY - MouseY}px`)
        .style('left',`${event.pageX - MouseX}px`)
       
      console.log("page x " + (event.pageX))

       console.log("page y " + (event.pageY))

       console.log("mouse page x " + (event.pageX - MouseX))

       console.log("mouse page y " + (event.pageY - MouseY))

      }

    let MouseX = 0

    let MouseY = 0

    let x = 0

    let y = 0


    let move = false

    d3.select('.info')
        .on('mousedown', () => {

            if(event.target.className == 'info')
            {
               // move = true
            }

            MouseX = event.offsetX

            MouseY = event.offsetY

            x = event.pageX

            y = event.pageY

            console.log(event.offsetX)

            console.log(event.offsetY)

            console.log("attribut" + d3.select('.info'))

            console.log('test')

            

        })
        .on('mousemove', () => {

            if(move)
            {
                    console.log("page x " + event.pageX)

                    console.log("Offset x " + event.offsetX)

                    console.log("left " + `${event.pageX - event.offsetX}`)
            }
        })
        .on('mouseup', () => {

            move = false

            console.log("mouveement" + event.movementX)
        })


const yMargin = 200;

   
const distanceMAX = 1900000

   
   let distance = d3.select('#distance')
            .style('height','95vh')
            .style('width','100vw')
            .on("click", () => {
                if(d3.event.target.localName == 'svg')
                {
                    hiddenInfo()
                    DATA.corps.forEach(d => hiddenPlanet(d))
                    DATA.corps.forEach(d => d.flag = 0)
                }
            })
            .selectAll('g')
            .data(DATA.corps)
            .enter()
            .append('g')
            .attr('class',d => d.id)
            .on("mouseover",d => {if(!d.flag && !flagAll) {showPlanet(d)}})
            .on("mouseout", d =>{if(!d.flag && !flagAll) {hiddenPlanet(d)}})
            .on("click", d => {if(!flagAll) {clickDistance(d)}})

            
            distance.append('line')
            .attr('x1',d => 2000 - d.data.DemiGrandAxe/distanceMAX)
            .attr('y1',(d,i) => i*yMargin + 100)
            .attr('x2','3000')
            .attr('y2',(d,i) => i*yMargin + 100)
            .attr('stroke','silver')
            .attr('stroke-width',45)
            .style('opacity',0)
            
            distance.append('line')
            .attr('class',d => `line${d.id}`)
            .attr('x1',d => 2000 - d.data.DemiGrandAxe/distanceMAX)
            .attr('y1',(d,i) => i*yMargin + 100)
            .attr('x2','3000')
            .attr('y2',(d,i) => i*yMargin + 100)
            .attr('stroke',d => d.color)
            .attr('stroke-width',5)
            .style('opacity',0)

            distance.append('circle')
            .attr('id',d => d.id)
            .attr('cx',d => 2000 - d.data.DemiGrandAxe/distanceMAX)
            .attr('cy',(d,i) => i*yMargin + 100)
            .attr('fill',d => d.color)
            .attr('r',d => d.rayon)

            distance.append('text')
            .attr('class',d => `text${d.id}`)
            .attr('x',d => 2000 - d.data.DemiGrandAxe/distanceMAX)
            .attr('y',(d,i) => (i*yMargin + 100) - d.rayon - 100)
            .attr('fill',d => d.color)
            .style('font-family','Verdana')
            .style('font-size','55px')
            .style('text-anchor','middle')
            .text(d => d.name)
            .style('visibility','hidden')



            distance.append('text')
            .attr('class',d => `text${d.id}`)
            .attr('x',(d,i) => 1800 - d.data.DemiGrandAxe/distanceMAX)
            .attr('y',(d,i) => i*yMargin + 100)
            .attr('fill','white')
            .style('font-family','Verdana')
            .style('font-size','40px')
            .style('text-anchor','end')
            .text(d => `Distance : ${d.data.DemiGrandAxe} ${DATA.infoData.DemiGrandAxe}`)
            .style('visibility','hidden')

        
            d3.select('#distance g.sun circle')
            .remove()

            d3.selectAll('#distance g.sun line')
            .remove()

            d3.selectAll('#distance g.sun text')
            .remove()

            d3.select('#distance g.sun')
            .raise()
            .append('circle')
            .attr('id','sun')
            .attr('cx', 3500)
            .attr('cy', 1000)
            .attr('fill','#fcbf1e')
            .attr('r',1000)



const xMargin = 380;

const volumeMAX = 1000

   
   let volume = d3.select('#volume')
            .style('height','95vh')
            .style('width','100vw')
            .on("click", () => {
                if(d3.event.target.localName == 'svg')
                {
                    hiddenInfo()
                    DATA.corps.forEach(d => hiddenPlanet(d))
                    DATA.corps.forEach(d => d.flag = 0)
                }
            })
            .selectAll('g')
            .data(DATA.corps)
            .enter()
            .append('g')
            .attr('class',d => d.id)
            .on("mouseover",d => {if(!d.flag && !flagAll) {showPlanet(d)}})
            .on("mouseout", d =>{if(!d.flag && !flagAll) {hiddenPlanet(d)}})
            .on("click", d => {if(!flagAll) {clickDistance(d)}})

            

            volume.append('circle')
            .attr('id',d => d.id)
            .attr('cx', (d,i) => i*xMargin)
            .attr('cy',1000)
            .attr('fill',d => d.color)
            .attr('r',d => d.data.rayon/volumeMAX)

            volume.append('circle')
            .attr("class",d => `orbite${d.id}`)
            .attr('cx', (d,i) => i*xMargin)
            .attr('cy',1000)
            .attr('r',d => d.data.rayon/volumeMAX + 100)
            .attr('fill',d => d.color)
            .style('opacity',0)

            volume.append('text')
            .attr('class',d => `text${d.id}`)
            .attr('x',(d,i) => i*xMargin)
            .attr('y',1000 - 100)
            .attr('fill',d => d.color)
            .style('font-family','Verdana')
            .style('font-size','55px')
            .style('text-anchor','middle')
            .text(d => d.name)
            .style('visibility','hidden')



            volume.append('text')
            .attr('class',d => `text${d.id}`)
            .attr('x',(d,i) => i*xMargin)
            .attr('y',1000 + 200)
            .attr('fill','white')
            .style('font-family','Verdana')
            .style('font-size','40px')
            .style('text-anchor','middle')
            .text(d => `volume : ${d.data.volume.volumeValue}x10*${d.data.volume.volumeExponent} ${DATA.infoData.volume}`)
            .style('visibility','hidden')



            d3.select('#volume g.sun circle')
            .attr('id','sun')
            .attr('cx',-xMargin - 270)

            d3.selectAll('#volume g.sun text')
            .attr('x',-xMargin - 220)
            .attr('y',(d,i) => i*100 +1000)

            d3.select('#volume g.sun circle.orbitesun')
            .remove()

